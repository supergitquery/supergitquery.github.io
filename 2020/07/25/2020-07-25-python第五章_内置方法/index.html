<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <link rel="dns-prefetch" href="http://yoursite.com">
  
  <title>python第五章_内置方法(魔法函数) | sgupergitquery</title>
  <meta name="author" content="sgupergitquery">
  
  <meta name="description" content="notes">
  
  
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

  <meta property="og:title" content="python第五章_内置方法(魔法函数)"/>
  <meta property="og:site_name" content="sgupergitquery"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="alternate" href="/atom.xml" title="sgupergitquery" type="application/atom+xml">

  <link rel="preload" as="style" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg">
  <link href="https://unpkg.com" rel="dns-prefetch" />
  <link href="https://busuanzi.ibruce.info" rel="dns-prefetch" />
  <link href="https://cdn1.lncld.net" rel="dns-prefetch" />
  
  <link href="https://xpjzs0ff.api.lncld.net" rel="dns-prefetch" />
  
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div class="container">


    <div class="left-col" style="background-image:url('https://tva1.sinaimg.cn/large/007S8ZIlgy1ggdmi6yapmj30dw0zk0wm.jpg')">
      <div class="intrude-less">
        <header id="header" class="inner">
          <a href="/">
            <div class="profilepic"><img src='https://s1.ax1x.com/2020/07/08/UZrhJx.jpg'></div>
          </a>
          <div class="author-name"><a href="/">sgupergitquery</a></div>
          <p class="aboutme">notes</p>
          <nav id="main-nav">
            <ul class="main">
              
              <li>
                
                  <a href="/archives">归档</a>
                
              </li>
              
              <li>
                
                  <a href="/categories">专题</a>
                
              </li>
              
            </ul>
          </nav>
          <nav id="sub-nav">
            <div class="social">
              
              
              
              
              
              
            </div>
          </nav>
        </header>
      </div>

    </div>



    <div class="mid-col">
      <div class="mid-col-container">
        <div id="content" class="inner">
          <article class="post">

  
    <div class="meta">
      
<div class="date">

<time datetime="2020-07-24T16:00:00.000Z"
      
      data-updated="true"
       itemprop="datePublished">
  2020-07-25
</time>





</div>

    </div>
  
  <h1 class="title" itemprop="name">python第五章_内置方法(魔法函数)</h1>
  <div class="entry-content" itemprop="articleBody">
    
    <div class="post-toc" id='TOC'>
      <div class="toc-title">TOC</div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#实例化"><span class="toc-number">1.</span> <span class="toc-text">实例化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#new"><span class="toc-number">1.1.</span> <span class="toc-text">__new__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#初始化"><span class="toc-number">2.</span> <span class="toc-text">初始化</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#init"><span class="toc-number">2.1.</span> <span class="toc-text">__init__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#属性操作"><span class="toc-number">3.</span> <span class="toc-text">属性操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#setattr"><span class="toc-number">3.1.</span> <span class="toc-text">__setattr__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#getattr"><span class="toc-number">3.2.</span> <span class="toc-text">__getattr__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delattr"><span class="toc-number">3.3.</span> <span class="toc-text">__delattr__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#getattribute"><span class="toc-number">3.4.</span> <span class="toc-text">__getattribute__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#描述符"><span class="toc-number">4.</span> <span class="toc-text">描述符</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#set"><span class="toc-number">4.1.</span> <span class="toc-text">__set__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#get"><span class="toc-number">4.2.</span> <span class="toc-text">__get__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delete"><span class="toc-number">4.3.</span> <span class="toc-text">__delete__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#注意的地方"><span class="toc-number">4.4.</span> <span class="toc-text">注意的地方</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#类属性-gt-数据描述符"><span class="toc-number">4.4.1.</span> <span class="toc-text">类属性&gt;数据描述符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#数据描述符-gt-实例属性"><span class="toc-number">4.4.2.</span> <span class="toc-text">数据描述符&gt;实例属性</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#实例属性-gt-非数据描述符"><span class="toc-number">4.4.3.</span> <span class="toc-text">实例属性&gt;非数据描述符</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#非数据描述符-gt-找不到"><span class="toc-number">4.4.4.</span> <span class="toc-text">非数据描述符&gt;找不到</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#应用"><span class="toc-number">4.5.</span> <span class="toc-text">应用</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#牛刀小试"><span class="toc-number">4.5.1.</span> <span class="toc-text">牛刀小试</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#拔刀相助"><span class="toc-number">4.5.2.</span> <span class="toc-text">拔刀相助</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#磨刀霍霍"><span class="toc-number">4.5.3.</span> <span class="toc-text">磨刀霍霍</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#大刀阔斧"><span class="toc-number">4.5.4.</span> <span class="toc-text">大刀阔斧</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类的装饰器-无参"><span class="toc-number">4.5.5.</span> <span class="toc-text">类的装饰器:无参</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#类的装饰器-有参"><span class="toc-number">4.5.6.</span> <span class="toc-text">类的装饰器:有参</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#刀光剑影"><span class="toc-number">4.5.7.</span> <span class="toc-text">刀光剑影</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#优先级问题"><span class="toc-number">4.5.8.</span> <span class="toc-text">优先级问题</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义property"><span class="toc-number">4.6.</span> <span class="toc-text">自定义property</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义classmethod"><span class="toc-number">4.7.</span> <span class="toc-text">自定义classmethod</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#自定义staticmethod"><span class="toc-number">4.8.</span> <span class="toc-text">自定义staticmethod</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#再看property"><span class="toc-number">4.9.</span> <span class="toc-text">再看property</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#总结"><span class="toc-number">4.10.</span> <span class="toc-text">总结</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#字典形式属性操作"><span class="toc-number">5.</span> <span class="toc-text">字典形式属性操作</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#setitem"><span class="toc-number">5.1.</span> <span class="toc-text">__setitem__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#getitem"><span class="toc-number">5.2.</span> <span class="toc-text">__getitem__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#delitem"><span class="toc-number">5.3.</span> <span class="toc-text">__delitem__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#改变对象显示"><span class="toc-number">6.</span> <span class="toc-text">改变对象显示</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#str"><span class="toc-number">6.1.</span> <span class="toc-text">__str__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#repr"><span class="toc-number">6.2.</span> <span class="toc-text">__repr__</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#format"><span class="toc-number">6.3.</span> <span class="toc-text">__format__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#节省空间"><span class="toc-number">7.</span> <span class="toc-text">节省空间:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#slots"><span class="toc-number">7.1.</span> <span class="toc-text">__slots__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#迭代协议"><span class="toc-number">8.</span> <span class="toc-text">迭代协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#next-与-iter"><span class="toc-number">8.1.</span> <span class="toc-text">__next__ 与 __iter__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#长度计算"><span class="toc-number">9.</span> <span class="toc-text">长度计算:</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#len"><span class="toc-number">9.1.</span> <span class="toc-text">__len__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#描述信息"><span class="toc-number">10.</span> <span class="toc-text">描述信息</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#doc"><span class="toc-number">10.1.</span> <span class="toc-text">__doc__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#模块与对象"><span class="toc-number">11.</span> <span class="toc-text">模块与对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#module-与-class"><span class="toc-number">11.1.</span> <span class="toc-text">__module__ 与 __class__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#资源释放"><span class="toc-number">12.</span> <span class="toc-text">资源释放</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#del"><span class="toc-number">12.1.</span> <span class="toc-text">del</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#上下文管理协议"><span class="toc-number">13.</span> <span class="toc-text">上下文管理协议</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#enter-与-exit"><span class="toc-number">13.1.</span> <span class="toc-text">__enter__ 与 __exit__</span></a></li></ol></li><li class="toc-item toc-level-1"><a class="toc-link" href="#调用对象"><span class="toc-number">14.</span> <span class="toc-text">调用对象</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#call"><span class="toc-number">14.1.</span> <span class="toc-text">__call__</span></a></li></ol></li></ol>
    </div>
    
    <hr>
<h1 id="实例化"><a href="#实例化" class="headerlink" title="实例化"></a>实例化</h1><hr>
<h2 id="new"><a href="#new" class="headerlink" title="__new__"></a>__new__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__new__(*args, **kwargs) method of builtins.type instance</span><br><span class="line">    Create and return a new object.  See help(type) for accurate signature.</span><br><span class="line">    创建并返回一个新对象,在被实例化时候调用</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span>  <span class="comment"># 实例化的时候调用</span></span><br><span class="line">        print(<span class="string">'实例化执行'</span>, cls, args, kwargs)</span><br><span class="line">        <span class="keyword">return</span> object.__new__(cls)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = Foo([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">实例化执行 &lt;class &#39;__main__.Foo&#39;&gt; ([1, 2, 3, 4],) &#123;&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="初始化"><a href="#初始化" class="headerlink" title="初始化"></a>初始化</h1><hr>
<h2 id="init"><a href="#init" class="headerlink" title="__init__"></a>__init__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">在实例化后如果实例的类定义了__init__,那么实例化对象后会自动运行__init__</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__new__</span><span class="params">(cls, *args, **kwargs)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> object.__new__(cls)</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        print(<span class="string">'初始化执行'</span>, self, value)</span><br><span class="line">        self.__dict__[<span class="string">'value'</span>] = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = Foo([<span class="number">1</span>, <span class="number">2</span>, <span class="number">3</span>, <span class="number">4</span>])</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">初始化执行 &lt;__main__.Foo object at 0x03BA3930&gt; [1, 2, 3, 4]</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="属性操作"><a href="#属性操作" class="headerlink" title="属性操作"></a>属性操作</h1><hr>
<h2 id="setattr"><a href="#setattr" class="headerlink" title="__setattr__"></a>__setattr__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">添加&#x2F;修改属性会触发它的执行</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">f'设置了<span class="subst">&#123;key&#125;</span>=<span class="subst">&#123;value&#125;</span>'</span>)</span><br><span class="line">        self.__dict__[key] = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A(<span class="string">'a'</span>)</span><br><span class="line">print(a.name)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">设置了name&#x3D;a</span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="getattr"><a href="#getattr" class="headerlink" title="__getattr__"></a>__getattr__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">只有在使用点调用属性且属性不存在的时候才会触发</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">f'设置了<span class="subst">&#123;key&#125;</span>=<span class="subst">&#123;value&#125;</span>'</span>)</span><br><span class="line">        self.__dict__[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">f'调用不存在的属性触发'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A(<span class="string">'a'</span>)</span><br><span class="line">print(a.name1)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">设置了name&#x3D;a</span><br><span class="line">调用不存在的属性触发</span><br><span class="line">None</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="delattr"><a href="#delattr" class="headerlink" title="__delattr__"></a>__delattr__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">删除属性的时候会触发</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">f'设置了<span class="subst">&#123;key&#125;</span>=<span class="subst">&#123;value&#125;</span>'</span>)</span><br><span class="line">        self.__dict__[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">f'调用不存在的属性触发'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">f'被del时触发'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A(<span class="string">'a'</span>)</span><br><span class="line"><span class="keyword">del</span> a.name</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">设置了name&#x3D;a</span><br><span class="line">被del时触发</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="getattribute"><a href="#getattribute" class="headerlink" title="__getattribute__"></a>__getattribute__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">不管属性存不存在都会执行,与__getattr__同时存在只会执行__getattribute__,</span><br><span class="line">除非__getattribute__在执行过程中抛出异常AttributeError</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,x)</span>:</span></span><br><span class="line">        self.x=x</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattribute__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'不管是否存在,我都会执行'</span>)</span><br><span class="line"></span><br><span class="line">f1=Foo(<span class="number">10</span>)</span><br><span class="line">f1.x</span><br><span class="line">f1.xxxxxx</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">不管是否存在,我都会执行</span><br><span class="line">不管是否存在,我都会执行</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="描述符"><a href="#描述符" class="headerlink" title="描述符"></a>描述符</h1><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">描述符本质就是一个新式类,在这个新式类中,至少实现了__get__(),__set__(),__delete__()中的一个,这也被称为描述符协议</span><br><span class="line"></span><br><span class="line">作用:是用来代理另外一个类的属性的(必须把描述符定义成这个类的类属性,不能定义到构造函数中)</span><br><span class="line"></span><br><span class="line">注意:描述符类产生的实例进行属性操作并不会触发三个方法的执行</span><br><span class="line"></span><br><span class="line">描述符分为两种:</span><br><span class="line">    数据描述符:至少实现了__get__()和__set__()</span><br><span class="line">    非数据描述符:没有实现__set__()</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span> <span class="comment">#在python3中Foo是新式类,它实现了三种方法,这个类就被称作一个描述符</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br></pre></td></tr></table></figure>


<hr>
<h2 id="set"><a href="#set" class="headerlink" title="__set__"></a>__set__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">为一个属性赋值时触发</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'触发__set__'</span>)</span><br><span class="line">        print(<span class="string">'传入的三个参数'</span>, self, instance, value)</span><br><span class="line">        self.name = value</span><br><span class="line">        print(<span class="string">'from Foo的名称空间'</span>, self.__dict__)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    name = Foo()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        <span class="comment"># slef.name的name被代理,相当于执行了 name.name = name</span></span><br><span class="line">        <span class="comment"># 第一个name是实例化的Foo(),第二个name是在__set__要设置的属性,第三个name是传入的值</span></span><br><span class="line">        <span class="comment"># 相当于Foo.name = name</span></span><br><span class="line">        self.name = name  </span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b = B(<span class="string">'我在哪'</span>)</span><br><span class="line"></span><br><span class="line">print(<span class="string">'from B 名称空间'</span>, b.__dict__)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">触发__set__</span><br><span class="line">传入的三个参数 &lt;__main__.Foo object at 0x038D0E90&gt; &lt;__main__.B object at 0x038D0F10&gt; 我在哪</span><br><span class="line">from Foo的名称空间 &#123;&#39;name&#39;: &#39;我在哪&#39;&#125;</span><br><span class="line">from B 名称空间 &#123;&#125;</span><br><span class="line"></span><br><span class="line"># 从运行结果可以看出设置的name属性在Foo实例化的对象里,B的实例化对象b是没有这个属性的</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="get"><a href="#get" class="headerlink" title="__get__"></a>__get__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">调用一个属性时触发</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'调用代理属性'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        self.name = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    name = Foo()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b = B(<span class="string">'我在哪'</span>)</span><br><span class="line">print(b.name)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">调用代理属性</span><br><span class="line">我在哪</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="delete"><a href="#delete" class="headerlink" title="__delete__"></a>__delete__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">采用del删除属性时触发</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        self.name = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'代理属性删除'</span>)</span><br><span class="line">        <span class="keyword">del</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span>  <span class="comment"># 防止报错</span></span><br><span class="line">        print(<span class="string">'不存在的属性'</span>)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    name = Foo()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b = B(<span class="string">'我在哪'</span>)</span><br><span class="line"><span class="keyword">del</span> b.name</span><br><span class="line">b.name</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">代理属性删除</span><br><span class="line">不存在的属性</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="注意的地方"><a href="#注意的地方" class="headerlink" title="注意的地方"></a>注意的地方</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line">1.描述符本身应该定义成新式类,被代理的类也应该是新式类</span><br><span class="line">2.必须把描述符定义成这个类的类属性,不能为定义到构造函数中</span><br><span class="line">3.要严格遵循该优先级,优先级由高到底分别是</span><br><span class="line">    a.类属性 </span><br><span class="line">    b.数据描述符</span><br><span class="line">    c.实例属性</span><br><span class="line">    d.非数据描述符</span><br><span class="line">    e.找不到的属性触发__getattr__()</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="类属性-gt-数据描述符"><a href="#类属性-gt-数据描述符" class="headerlink" title="类属性&gt;数据描述符"></a>类属性&gt;数据描述符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">描述符在使用时被定义成另外一个类的类属性,因而类属性比二次加工的描述符伪装而来的类属性有更高的优先级</span><br><span class="line">B.name 类调用类属性name,因为我们只定义了描述符属性,类属性找不到就去找描述符伪装的类属性name,触发了__get__()</span><br><span class="line"></span><br><span class="line">B.name&#x3D;&#39;AAA&#39; 那赋值呢,直接赋值了一个类属性,它拥有更高的优先级,相当于覆盖了描述符,肯定不会触发描述符的__set__()</span><br><span class="line">del B.name #同上</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'触发__get__'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'触发__set__'</span>)</span><br><span class="line">        self.name = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        <span class="keyword">del</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="literal">None</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    name = Foo()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @classmethod</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(cls, item)</span>:</span></span><br><span class="line">        print(<span class="string">'不存在的类属性'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(B.__dict__[<span class="string">'name'</span>])</span><br><span class="line">B.name                     <span class="comment"># 类调用也会触发__get__,因为类属性不存在name,就会去描述符里找</span></span><br><span class="line">B.name = <span class="number">1</span>                 <span class="comment"># 但是赋值的操作是增加类属性,类属性比描述符优先级高,这样也是相当于覆盖类属性</span></span><br><span class="line">print(B.__dict__[<span class="string">'name'</span>])  <span class="comment"># name的值已经被改变了,原来是&lt;__main__.Foo object at 0x011E5050&gt;,现在是1</span></span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&lt;__main__.Foo object at 0x011E5050&gt;</span><br><span class="line">触发__get__</span><br><span class="line">1</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="数据描述符-gt-实例属性"><a href="#数据描述符-gt-实例属性" class="headerlink" title="数据描述符&gt;实例属性"></a>数据描述符&gt;实例属性</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">如果描述符是一个数据描述符(即有__get__又有__set__),那么b.name的调用与赋值都是触发描述符的操作,</span><br><span class="line">于p1本身无关了,b.name&#x3D;&#39;AAA&#39;相当于覆盖了实例的属性,实例的属性字典中没有name,因为name是一个数据描述符,</span><br><span class="line">优先级高于实例属性,查看&#x2F;赋值&#x2F;删除都是跟描述符有关,与实例无关了</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'触发__get__'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'触发__set__'</span>)</span><br><span class="line">        self.name = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        <span class="keyword">del</span> self.name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span>:</span></span><br><span class="line">    name = Foo()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">b = B(<span class="string">'b'</span>)</span><br><span class="line">print(b.__dict__)</span><br><span class="line">b.name</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">触发__set__</span><br><span class="line">&#123;&#125;</span><br><span class="line">触发__get__</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="实例属性-gt-非数据描述符"><a href="#实例属性-gt-非数据描述符" class="headerlink" title="实例属性&gt;非数据描述符"></a>实例属性&gt;非数据描述符</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">函数是一个非数据描述符对象,有人可能会问,描述符不都是类么,函数怎么算也应该是一个对象啊,怎么就是描述符了,</span><br><span class="line">描述符是类没问题,描述符在应用的时候不都是实例化成一个类属性么,函数就是一个由非描述符类实例化得到的对象</span><br><span class="line">没错,字符串也一样</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'我胡汉三又回来了'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f1 = Foo()</span><br><span class="line">f1.func()  <span class="comment"># 调用类的方法,也可以说是调用非数据描述符</span></span><br><span class="line"><span class="comment"># 函数是一个非数据描述符对象(一切皆对象么)</span></span><br><span class="line">print(hasattr(Foo.func, <span class="string">'__set__'</span>))</span><br><span class="line">print(hasattr(Foo.func, <span class="string">'__get__'</span>))</span><br><span class="line">print(hasattr(Foo.func, <span class="string">'__delete__'</span>))</span><br><span class="line"></span><br><span class="line">f1.func = <span class="string">'这是实例属性啊'</span></span><br><span class="line">print(f1.func)</span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> f1.func  <span class="comment"># 删掉了非数据</span></span><br><span class="line">f1.func()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">我胡汉三又回来了</span><br><span class="line">False</span><br><span class="line">True</span><br><span class="line">False</span><br><span class="line">这是实例属性啊</span><br><span class="line">我胡汉三又回来了</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'get'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Room</span>:</span></span><br><span class="line">    name = Foo()</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, width, length)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.width = width</span><br><span class="line">        self.length = length</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># name是一个非数据描述符,因为name=Foo()而Foo没有实现set方法,因而比实例属性有更低的优先级</span></span><br><span class="line"><span class="comment"># 对实例的属性操作,触发的都是实例自己的</span></span><br><span class="line">r1 = Room(<span class="string">'厕所'</span>, <span class="number">1</span>, <span class="number">1</span>)</span><br><span class="line">r1.name</span><br><span class="line">r1.name = <span class="string">'厨房'</span></span><br><span class="line"></span><br><span class="line">print(r1.name)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">厨房</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="非数据描述符-gt-找不到"><a href="#非数据描述符-gt-找不到" class="headerlink" title="非数据描述符&gt;找不到"></a>非数据描述符&gt;找不到</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">非数据描述符&gt;找不到</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">func</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'我胡汉三又回来了'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getattr__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'找不到了当然是来找我啦'</span>,item)</span><br><span class="line">f1=Foo()</span><br><span class="line"></span><br><span class="line">f1.xxxxxxxxxxx</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">找不到了当然是来找我啦 xxxxxxxxxxx</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="应用"><a href="#应用" class="headerlink" title="应用"></a>应用</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">众所周知,python是弱类型语言,即参数的赋值没有类型限制,下面我们通过描述符机制来实现类型限制功能</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="牛刀小试"><a href="#牛刀小试" class="headerlink" title="牛刀小试"></a>牛刀小试</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Str</span>:</span>  <span class="comment"># 对 name属性操作</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'get---&gt;'</span>, instance, owner)</span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[self.name]  <span class="comment"># 获取People的空间里的name属性</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'set---&gt;'</span>, instance, value)</span><br><span class="line">        instance.__dict__[self.name] = value  <span class="comment"># 将name属性存到People的空间里,不代理</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span>   <span class="comment"># 删除People的空间里的name属性</span></span><br><span class="line">        print(<span class="string">'delete---&gt;'</span>, instance)</span><br><span class="line">        instance.__dict__.pop(self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    name = Str(<span class="string">'name'</span>)  <span class="comment"># 表示操作name属性,因为描述符不会传入属性名,手动传入</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, salary)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.salary = salary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = People(<span class="string">'alex'</span>, <span class="number">18</span>, <span class="number">3231</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 调用</span></span><br><span class="line">print(p1.__dict__)</span><br><span class="line">p1.name</span><br><span class="line"></span><br><span class="line"><span class="comment"># 赋值</span></span><br><span class="line">print(p1.__dict__)</span><br><span class="line">p1.name = <span class="string">'egonlin'</span></span><br><span class="line">print(p1.__dict__)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 删除</span></span><br><span class="line">print(p1.__dict__)</span><br><span class="line"><span class="keyword">del</span> p1.name</span><br><span class="line">print(p1.__dict__)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br></pre></td><td class="code"><pre><span class="line"># 实例化</span><br><span class="line">set---&gt; &lt;__main__.People object at 0x03247F70&gt; alex</span><br><span class="line"></span><br><span class="line"># 调用</span><br><span class="line">&#123;&#39;name&#39;: &#39;alex&#39;, &#39;age&#39;: 18, &#39;salary&#39;: 3231&#125;</span><br><span class="line">get---&gt; &lt;__main__.People object at 0x03247F70&gt; &lt;class &#39;__main__.People&#39;&gt;</span><br><span class="line"></span><br><span class="line"># 赋值</span><br><span class="line">&#123;&#39;name&#39;: &#39;alex&#39;, &#39;age&#39;: 18, &#39;salary&#39;: 3231&#125;</span><br><span class="line">set---&gt; &lt;__main__.People object at 0x03247F70&gt; egonlin</span><br><span class="line">&#123;&#39;name&#39;: &#39;egonlin&#39;, &#39;age&#39;: 18, &#39;salary&#39;: 3231&#125;</span><br><span class="line"></span><br><span class="line"># 删除</span><br><span class="line">&#123;&#39;name&#39;: &#39;egonlin&#39;, &#39;age&#39;: 18, &#39;salary&#39;: 3231&#125;</span><br><span class="line">delete---&gt; &lt;__main__.People object at 0x03247F70&gt;</span><br><span class="line">&#123;&#39;age&#39;: 18, &#39;salary&#39;: 3231&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="拔刀相助"><a href="#拔刀相助" class="headerlink" title="拔刀相助"></a>拔刀相助</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Str</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'get---&gt;'</span>, instance, owner)</span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:  <span class="comment"># 增加了instance的判断,如果是类调用,instance就是None,程序会报错</span></span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[self.name]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'set---&gt;'</span>, instance, value)</span><br><span class="line">        instance.__dict__[self.name] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'delete---&gt;'</span>, instance)</span><br><span class="line">        instance.__dict__.pop(self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    name = Str(<span class="string">'name'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, salary)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.salary = salary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(People.name)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">get---&gt; None &lt;class &#39;__main__.People&#39;&gt;</span><br><span class="line">&lt;__main__.Str object at 0x03627030&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="磨刀霍霍"><a href="#磨刀霍霍" class="headerlink" title="磨刀霍霍"></a>磨刀霍霍</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Str</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, expected_type)</span>:</span>  <span class="comment"># 传入属性名称和期望类型</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.expected_type = expected_type</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'get---&gt;'</span>, instance, owner)</span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[self.name]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'set---&gt;'</span>, instance, value)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, self.expected_type):  <span class="comment"># 如果不是期望的类型,则抛出异常</span></span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'Expected %s'</span> % str(self.expected_type))</span><br><span class="line">        instance.__dict__[self.name] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'delete---&gt;'</span>, instance)</span><br><span class="line">        instance.__dict__.pop(self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    name = Str(<span class="string">'name'</span>, str)  <span class="comment"># 新增类型限制str</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, salary)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.salary = salary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = People(<span class="number">123</span>, <span class="number">18</span>, <span class="number">3333.3</span>)  <span class="comment"># 传入的name因不是字符串类型而抛出异常</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line"># 不是期望的类型,报错</span><br><span class="line">TypeError: Expected &lt;class &#39;str&#39;&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="大刀阔斧"><a href="#大刀阔斧" class="headerlink" title="大刀阔斧"></a>大刀阔斧</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typed</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, expected_type)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.expected_type = expected_type</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'get---&gt;'</span>, instance, owner)</span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[self.name]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'set---&gt;'</span>, instance, value)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, self.expected_type):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'Expected %s'</span> % str(self.expected_type))</span><br><span class="line">        instance.__dict__[self.name] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'delete---&gt;'</span>, instance)</span><br><span class="line">        instance.__dict__.pop(self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    name = Typed(<span class="string">'name'</span>, str)  <span class="comment"># 对三个属性都进行限制类型</span></span><br><span class="line">    age = Typed(<span class="string">'name'</span>, int)</span><br><span class="line">    salary = Typed(<span class="string">'name'</span>, float)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, salary)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.salary = salary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># p1 = People(123, 18, 3333.3)  # name属性是数字,会报错</span></span><br><span class="line"><span class="comment"># p1 = People('egon', '18', 3333.3)  # age属性是字符串,会报错</span></span><br><span class="line">p1 = People(<span class="string">'egon'</span>, <span class="number">18</span>, <span class="number">3333</span>)  <span class="comment"># salary属性是整数,会报错</span></span><br><span class="line">p1 = People(<span class="string">'egon'</span>, <span class="number">18</span>, <span class="number">3333.3</span>)  <span class="comment"># 都是预期类型,正确</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">set---&gt; &lt;__main__.People object at 0x02C9D610&gt; egon</span><br><span class="line">set---&gt; &lt;__main__.People object at 0x02C9D610&gt; 18</span><br><span class="line">set---&gt; &lt;__main__.People object at 0x02C9D610&gt; 3333.3</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="类的装饰器-无参"><a href="#类的装饰器-无参" class="headerlink" title="类的装饰器:无参"></a>类的装饰器:无参</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">大刀阔斧之后我们已然能实现功能了,但是问题是,如果我们的类有很多属性,仍然采用在定义一堆类属性的方式去实现</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(cls)</span>:</span></span><br><span class="line">    print(<span class="string">'类的装饰器开始运行啦------&gt;'</span>)</span><br><span class="line">    print(cls)</span><br><span class="line">    <span class="keyword">return</span> cls</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="meta">@decorate  # 无参:People=decorate(People)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, salary)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.salary = salary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = People(<span class="string">'egon'</span>, <span class="number">18</span>, <span class="number">3333.3</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">类的装饰器开始运行啦------&gt;</span><br><span class="line">&lt;class &#39;__main__.People&#39;&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="类的装饰器-有参"><a href="#类的装饰器-有参" class="headerlink" title="类的装饰器:有参"></a>类的装饰器:有参</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">typeassert</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">'类的装饰器开始运行啦------&gt;'</span>, kwargs)</span><br><span class="line">        <span class="keyword">return</span> cls</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有参:</span></span><br><span class="line"><span class="comment"># 1.运行typeassert(...)返回结果是decorate,此时参数都传给kwargs </span></span><br><span class="line"><span class="comment"># 2.People=decorate(People)</span></span><br><span class="line"><span class="meta">@typeassert(name=str, age=int, salary=float)</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, salary)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.salary = salary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = People(<span class="string">'egon'</span>, <span class="number">18</span>, <span class="number">3333.3</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">类的装饰器开始运行啦------&gt; &#123;&#39;name&#39;: &lt;class &#39;str&#39;&gt;, &#39;age&#39;: &lt;class &#39;int&#39;&gt;, &#39;salary&#39;: &lt;class &#39;float&#39;&gt;&#125;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="刀光剑影"><a href="#刀光剑影" class="headerlink" title="刀光剑影"></a>刀光剑影</h3><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Typed</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, expected_type)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.expected_type = expected_type</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'get---&gt;'</span>, instance, owner)</span><br><span class="line">        <span class="keyword">if</span> instance <span class="keyword">is</span> <span class="literal">None</span>:</span><br><span class="line">            <span class="keyword">return</span> self</span><br><span class="line">        <span class="keyword">return</span> instance.__dict__[self.name]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'set---&gt;'</span>, instance, value)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, self.expected_type):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'Expected %s'</span> % str(self.expected_type))</span><br><span class="line">        instance.__dict__[self.name] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delete__</span><span class="params">(self, instance)</span>:</span></span><br><span class="line">        print(<span class="string">'delete---&gt;'</span>, instance)</span><br><span class="line">        instance.__dict__.pop(self.name)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="function"><span class="keyword">def</span> <span class="title">typeassert</span><span class="params">(**kwargs)</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">decorate</span><span class="params">(cls)</span>:</span></span><br><span class="line">        print(<span class="string">'类的装饰器开始运行啦------&gt;'</span>, kwargs)</span><br><span class="line">        <span class="keyword">for</span> name, expected_type <span class="keyword">in</span> kwargs.items():</span><br><span class="line">            setattr(cls, name, Typed(name, expected_type))</span><br><span class="line">        <span class="keyword">return</span> cls</span><br><span class="line"></span><br><span class="line">    <span class="keyword">return</span> decorate</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 有参:</span></span><br><span class="line"><span class="comment"># 1.运行typeassert(...)返回结果是decorate,此时参数都传给kwargs</span></span><br><span class="line"><span class="comment"># 2.People=decorate(People)</span></span><br><span class="line"><span class="meta">@typeassert(name=str, age=int,</span></span><br><span class="line">            salary=float)</span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name, age, salary)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line">        self.age = age</span><br><span class="line">        self.salary = salary</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># p1 = typeassert(name=str, age=int, salary=float)(People)('egon',18,3333.3)</span></span><br><span class="line"></span><br><span class="line">p1 = People(<span class="string">'egon'</span>,<span class="number">18</span>,<span class="number">3333.3</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">类的装饰器开始运行啦------&gt; &#123;&#39;name&#39;: &lt;class &#39;str&#39;&gt;, &#39;age&#39;: &lt;class &#39;int&#39;&gt;, &#39;salary&#39;: &lt;class &#39;float&#39;&gt;&#125;</span><br><span class="line">set---&gt; &lt;__main__.People object at 0x039F70D0&gt; egon</span><br><span class="line">set---&gt; &lt;__main__.People object at 0x039F70D0&gt; 18</span><br><span class="line">set---&gt; &lt;__main__.People object at 0x039F70D0&gt; 3333.3</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="优先级问题"><a href="#优先级问题" class="headerlink" title="优先级问题"></a>优先级问题</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line">下面两个脚本的区别在于:</span><br><span class="line">非数据描述符&lt;实例属性</span><br><span class="line">    第一个脚本实现了一个缓存的效果,第一次执行call,触发__get__会让对象生成一个a.call &#x3D; &#39;a&#39;的属性,</span><br><span class="line">    由于 非数据描述符&lt;实例属性,后面再调用的call是实例的属性,而不是描述符.</span><br><span class="line"></span><br><span class="line">变为数据描述符&gt;实例属性:</span><br><span class="line">    第二个脚本在第一个脚本的基础上添加了__set__,第一次执行call,触发__get__也会让对象生成一个a.call &#x3D; &#39;a&#39;的属性,</span><br><span class="line">    但是第二次调用call还会触发__get__,这是因为 __get__和__set__同时实现就会变为 变为数据描述符&gt;实例属性 ,</span><br><span class="line">    每次对这个属性的操作都会优先找描述符.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 非数据描述符&lt;实例属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span>  <span class="comment"># 非数据描述符类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func)</span>:</span></span><br><span class="line">        self.func = func</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'触发__get__ ...'</span>)</span><br><span class="line">        value = self.func(instance)</span><br><span class="line">        instance.__dict__[self.func.__name__] = value  <span class="comment"># 相当于a.call = a.call()</span></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @Test</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A(<span class="string">'a'</span>)</span><br><span class="line">print(a.__dict__)  <span class="comment"># 在调用call之前查看a的名称空间</span></span><br><span class="line">print(a.call)      <span class="comment"># 第一次调用call,触发__get__</span></span><br><span class="line">print(a.__dict__)  <span class="comment"># 再次查看名称空间,发现a多出了一个call实例属性</span></span><br><span class="line">print(a.call)      <span class="comment"># 再次调用call,没有触发__get__</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;_A__name&#39;: &#39;a&#39;&#125;</span><br><span class="line">触发__get__ ...</span><br><span class="line">a</span><br><span class="line">&#123;&#39;_A__name&#39;: &#39;a&#39;, &#39;call&#39;: &#39;a&#39;&#125;</span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 数据描述符&gt;实例属性</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span>  <span class="comment"># 数据描述符类</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func)</span>:</span></span><br><span class="line">        self.func = func</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'触发__get__ ...'</span>)</span><br><span class="line">        value = self.func(instance)</span><br><span class="line">        instance.__dict__[self.func.__name__] = value  <span class="comment"># 相当于a.__dict__['call'] = a.call()</span></span><br><span class="line">        <span class="keyword">return</span> value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__set__</span><span class="params">(self, instance, value)</span>:</span></span><br><span class="line">        print(<span class="string">'与__get__同时存在,升级为数据描述符类'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @Test</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A(<span class="string">'a'</span>)</span><br><span class="line">print(a.__dict__)</span><br><span class="line">print(a.call)</span><br><span class="line">print(a.__dict__)</span><br><span class="line">print(a.call)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;_A__name&#39;: &#39;a&#39;&#125;</span><br><span class="line">触发__get__ ...</span><br><span class="line">a</span><br><span class="line">&#123;&#39;_A__name&#39;: &#39;a&#39;, &#39;call&#39;: &#39;a&#39;&#125;</span><br><span class="line">触发__get__ ...</span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="自定义property"><a href="#自定义property" class="headerlink" title="自定义property"></a>自定义property</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func)</span>:</span></span><br><span class="line">        print(<span class="string">'定义就执行'</span>)</span><br><span class="line">        self.func = func</span><br><span class="line"><span class="comment">#       print(self.func)</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        print(<span class="string">'调用就执行'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.func(instance)  <span class="comment"># 相当于 A.call(a_obj)</span></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line">        </span><br><span class="line"><span class="meta">    @Test  # 实现与property相同的效果</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'取值就执行'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.__name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A(<span class="string">'a'</span>)</span><br><span class="line">print(a.call)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">定义就执行</span><br><span class="line">调用就执行</span><br><span class="line">取值就执行</span><br><span class="line">a</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="自定义classmethod"><a href="#自定义classmethod" class="headerlink" title="自定义classmethod"></a>自定义classmethod</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 不带参数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func)</span>:</span></span><br><span class="line">        self.func = func</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.func(owner)  <span class="comment"># 相当于执行 A.call_id(A)</span></span><br><span class="line">        <span class="keyword">return</span> call</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @Test</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_id</span><span class="params">(cls)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> id(cls)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(A.call_id())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">46678064</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br></pre></td><td class="code"><pre><span class="line"><span class="comment"># 带参数</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func)</span>:</span></span><br><span class="line">        self.func = func</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">call</span><span class="params">(*args, **kwargs)</span>:</span> </span><br><span class="line">            <span class="keyword">return</span> self.func(owner, *args, **kwargs)  <span class="comment"># 接收的参数原封不动的返回</span></span><br><span class="line">        <span class="keyword">return</span> call</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @Test</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_id</span><span class="params">(cls, age)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> id(cls), age</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(A.call_id(<span class="number">18</span>))</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">(50675760, 18)</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="自定义staticmethod"><a href="#自定义staticmethod" class="headerlink" title="自定义staticmethod"></a>自定义staticmethod</h2><figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Test</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, func)</span>:</span></span><br><span class="line">        self.func = func  <span class="comment"># func = A.call_id</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__get__</span><span class="params">(self, instance, owner)</span>:</span></span><br><span class="line">        <span class="function"><span class="keyword">def</span> <span class="title">test</span><span class="params">()</span>:</span></span><br><span class="line">            <span class="keyword">return</span> self.func()  <span class="comment"># 直接返回A.call_id()就好了</span></span><br><span class="line">        <span class="keyword">return</span> test</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.__name = name</span><br><span class="line"></span><br><span class="line"><span class="meta">    @Test</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">call_id</span><span class="params">()</span>:</span></span><br><span class="line">        <span class="keyword">return</span> id(A)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">print(A.call_id())</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">53297200</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="再看property"><a href="#再看property" class="headerlink" title="再看property"></a>再看property</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">一个静态属性property本质就是实现了get,set,delete三种方法</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">get_AAA</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'get的时候运行我啊'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">set_AAA</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        print(<span class="string">'set的时候运行我啊'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">delete_AAA</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'delete的时候运行我啊'</span>)</span><br><span class="line"></span><br><span class="line">    AAA = property(get_AAA, set_AAA, delete_AAA)  <span class="comment"># 内置property三个参数与get,set,delete一一对应</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">f1 = Foo()</span><br><span class="line">f1.AAA</span><br><span class="line">f1.AAA = <span class="string">'aaa'</span></span><br><span class="line"><span class="keyword">del</span> f1.AAA</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">get的时候运行我啊</span><br><span class="line">set的时候运行我啊</span><br><span class="line">delete的时候运行我啊</span><br></pre></td></tr></table></figure>

<hr>
<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">因为property实际上是实现了get,set,delete三种方法,所以他是数据描述符,又因为</span><br><span class="line">在p1实例化之前@property已经被执行了,相当于已经执行了People.name &#x3D; property(name)</span><br><span class="line"></span><br><span class="line">实例属性name 优先级小于 数据描述符的name,当调用self.name的时候,实际上是</span><br><span class="line">在调用数据描述符,所以不能直接返回self.name,这样就是无限的递归调用.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">People</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name  <span class="comment"># 实例化就触发property</span></span><br><span class="line"></span><br><span class="line"><span class="meta">    @property</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="comment"># return self.name #无限递归</span></span><br><span class="line">        print(<span class="string">'get------&gt;'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.DouNiWan</span><br><span class="line"></span><br><span class="line"><span class="meta">    @name.setter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        print(<span class="string">'set------&gt;'</span>)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> isinstance(value, str):</span><br><span class="line">            <span class="keyword">raise</span> TypeError(<span class="string">'必须是字符串类型'</span>)</span><br><span class="line">        self.DouNiWan = value</span><br><span class="line"></span><br><span class="line"><span class="meta">    @name.deleter</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">name</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'delete------&gt;'</span>)</span><br><span class="line">        <span class="keyword">del</span> self.DouNiWan</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">p1 = People(<span class="string">'alex'</span>)  <span class="comment"># self.name实际是存放到self.DouNiWan里</span></span><br><span class="line">p1.name = <span class="string">'1'</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">set------&gt;</span><br><span class="line">set------&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="总结"><a href="#总结" class="headerlink" title="总结"></a>总结</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">描述符是可以实现大部分python类特性中的底层魔法,包括@classmethod,@staticmethd,@property甚至是__slots__属性</span><br><span class="line"></span><br><span class="line">描述父是很多高级库和框架的重要工具之一,描述符通常是使用到装饰器或者元类的大型框架中的一个组件.</span><br><span class="line"></span><br><span class="line">利用描述符原理完成一个自定制@property,实现延迟计算(本质就是把一个函数属性利用装饰器原理做成一个描述符：类的属性字典中函数名为key,value为描述符类产生的对象)</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="字典形式属性操作"><a href="#字典形式属性操作" class="headerlink" title="字典形式属性操作"></a>字典形式属性操作</h1><hr>
<h2 id="setitem"><a href="#setitem" class="headerlink" title="__setitem__"></a>__setitem__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">像字典一样给属性赋值触发</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">'像字典一样赋值触发'</span>)</span><br><span class="line">        self.__dict__[key] = value</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = Foo()</span><br><span class="line">a.name = <span class="string">'a'</span>  <span class="comment"># 这样赋值不会触发</span></span><br><span class="line"></span><br><span class="line">a[<span class="string">'age'</span>] = <span class="number">18</span>  <span class="comment"># 这里触发</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">像字典一样赋值触发</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="getitem"><a href="#getitem" class="headerlink" title="__getitem__"></a>__getitem__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">像字典一样取属性值触发</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">'像字典一样赋值触发'</span>)</span><br><span class="line">        self.__dict__[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'像字典一样取值触发'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.__dict__[item]</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = Foo()</span><br><span class="line">a.name = <span class="string">'a'</span></span><br><span class="line">a[<span class="string">'name'</span>]  <span class="comment"># 这里触发</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">像字典一样取值触发</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="delitem"><a href="#delitem" class="headerlink" title="__delitem__"></a>__delitem__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">像字典一样删除属性触发</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setitem__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        print(<span class="string">'像字典一样赋值触发'</span>)</span><br><span class="line">        self.__dict__[key] = value</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__getitem__</span><span class="params">(self, item)</span>:</span></span><br><span class="line">        print(<span class="string">'像字典一样取值触发'</span>)</span><br><span class="line">        <span class="keyword">return</span> self.__dict__[item]</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__delitem__</span><span class="params">(self, key)</span>:</span></span><br><span class="line">        print(<span class="string">'像字典一样删除属性触发'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = Foo()</span><br><span class="line">a.name = <span class="string">'a'</span></span><br><span class="line"></span><br><span class="line"><span class="keyword">del</span> a[<span class="string">'name'</span>]  <span class="comment"># 这里触发</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">像字典一样删除属性触发</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="改变对象显示"><a href="#改变对象显示" class="headerlink" title="改变对象显示"></a>改变对象显示</h1><hr>
<h2 id="str"><a href="#str" class="headerlink" title="__str__"></a>__str__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str函数或者print函数会运行obj.__str__(),如果__str__没有被定义,</span><br><span class="line">那么就会使用__repr__来代替输出,返回值必须是字符串,否则抛出异常</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__str__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'from __str__'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(<span class="string">'str'</span>, str(a))</span><br><span class="line">print(<span class="string">'print'</span>, a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">str from __str__</span><br><span class="line">print from __str__</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="repr"><a href="#repr" class="headerlink" title="__repr__"></a>__repr__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">repr函数或者交互式解释器会运行obj.__repr__(),如果__str__没有被定义,</span><br><span class="line">那么就会使用__repr__来代替输出,返回值必须是字符串,否则抛出异常</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__repr__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'from __repr__'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(<span class="string">'repr'</span>, repr(a))</span><br><span class="line">print(<span class="string">'print'</span>, a)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">repr from __repr__</span><br><span class="line">print from __repr__</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="format"><a href="#format" class="headerlink" title="__format__"></a>__format__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">format(obj, fmt_str) 或者 &#39;&#123;fmt_str&#125;&#39;.format(obj) 会执行 obj.__format__</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br></pre></td><td class="code"><pre><span class="line">date_dic=&#123;</span><br><span class="line">    <span class="string">'ymd'</span>:<span class="string">'&#123;0.year&#125;:&#123;0.month&#125;:&#123;0.day&#125;'</span>,</span><br><span class="line">    <span class="string">'dmy'</span>:<span class="string">'&#123;0.day&#125;/&#123;0.month&#125;/&#123;0.year&#125;'</span>,</span><br><span class="line">    <span class="string">'mdy'</span>:<span class="string">'&#123;0.month&#125;-&#123;0.day&#125;-&#123;0.year&#125;'</span>,</span><br><span class="line">&#125;</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Date</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,year,month,day)</span>:</span></span><br><span class="line">        self.year=year</span><br><span class="line">        self.month=month</span><br><span class="line">        self.day=day</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__format__</span><span class="params">(self, format_spec)</span>:</span>  <span class="comment"># 发现不能给format_spec设置为默认参数,不知道是什么原因</span></span><br><span class="line">        print(format_spec)</span><br><span class="line">        <span class="keyword">if</span> <span class="keyword">not</span> format_spec <span class="keyword">or</span> format_spec <span class="keyword">not</span> <span class="keyword">in</span> date_dic:</span><br><span class="line">            format_spec=<span class="string">'ymd'</span></span><br><span class="line">        fmt=date_dic[format_spec]</span><br><span class="line"></span><br><span class="line">        <span class="comment"># fmt.format(self) ==&gt; '&#123;0.year&#125;:&#123;0.month&#125;:&#123;0.day&#125;'.format(d1)</span></span><br><span class="line">        <span class="keyword">return</span> fmt.format(self)   <span class="comment">#  '&#123;d1.year&#125;:&#123;d1.month&#125;:&#123;d1.day&#125;'</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">d1=Date(<span class="number">2016</span>,<span class="number">12</span>,<span class="number">29</span>)</span><br><span class="line">print(format(d1))  <span class="comment"># 这里没有传入format_spec是因为在__format__内部进行了处理</span></span><br><span class="line">print(<span class="string">'&#123;:mdy&#125;'</span>.format(d1))  <span class="comment"># 这样的形式相当于 format(d1, mdy)</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">2016:12:29</span><br><span class="line">12-29-2016</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="节省空间"><a href="#节省空间" class="headerlink" title="节省空间:"></a>节省空间:</h1><hr>
<h2 id="slots"><a href="#slots" class="headerlink" title="__slots__"></a>__slots__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">1.__slots__是什么:是一个类变量,变量值可以是列表,元祖,或者可迭代对象,也可以是一个字符串(意味着所有实例只有一个数据属性)</span><br><span class="line"></span><br><span class="line">2.引子:使用点来访问属性本质就是在访问类或者对象的__dict__属性字典(类的字典是共享的,而每个实例的是独立的)</span><br><span class="line"></span><br><span class="line">3.为何使用__slots__:字典会占用大量内存,如果你有一个属性很少的类,但是有很多实例,为了节省内存可以使用__slots__取代实例的__dict__当你定义__slots__后,</span><br><span class="line">__slots__就会为实例使用一种更加紧凑的内部表示.实例通过一个很小的固定大小的数组来构建,而不是为每个实例定义一个字典,这跟元组或列表很类似.</span><br><span class="line">在__slots__中列出的属性名在内部被映射到这个数组的指定小标上.使用__slots__缺点在于我们不能再给实例添加新的属性了,只能使用在__slots__中定义的那些属性名.</span><br><span class="line"></span><br><span class="line">4.注意事项:__slots__的很多特性都依赖于普通的基于字典的实现.另外,定义了__slots__后的类不再 支持一些普通类特性了,比如多继承.大多数情况下,你应该</span><br><span class="line">只在那些经常被使用到 的用作数据结构的类上定义__slots__比如在程序中需要创建某个类的几百万个实例对象 .</span><br><span class="line">关于__slots__的一个常见误区是它可以作为一个封装工具来防止用户给实例增加新的属性.尽管使用__slots__可以达到这样的目的,但是这个并不是它的初衷.           更多的是用来作为一个内存优化工具.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    __slots__ = <span class="string">'name'</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">B</span><span class="params">(A)</span>:</span></span><br><span class="line">    __slots__ = [<span class="string">'age'</span>, <span class="string">'sex'</span>]</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, age, sex)</span>:</span></span><br><span class="line">        self.age = age</span><br><span class="line">        self.sex = sex</span><br><span class="line">    </span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化A查看属性</span></span><br><span class="line">a = A(<span class="string">'jack'</span>)</span><br><span class="line">print(<span class="string">'a'</span>, a.name)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 实例化B查看属性,并查看是否继承A的属性</span></span><br><span class="line">b = B(<span class="number">18</span>, <span class="string">'man'</span>)</span><br><span class="line"></span><br><span class="line"><span class="keyword">if</span> hasattr(b, <span class="string">'name'</span>):</span><br><span class="line">    print(<span class="string">'b'</span>, b.name)</span><br><span class="line"><span class="keyword">else</span>:</span><br><span class="line">    print(<span class="string">'b not has "name" attr'</span>)</span><br><span class="line">print(<span class="string">'b'</span>, b.age)</span><br><span class="line">print(<span class="string">'b'</span>, b.sex)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line">a jack</span><br><span class="line">b not has &quot;name&quot; attr</span><br><span class="line">b 18</span><br><span class="line">b man</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="迭代协议"><a href="#迭代协议" class="headerlink" title="迭代协议"></a>迭代协议</h1><hr>
<h2 id="next-与-iter"><a href="#next-与-iter" class="headerlink" title="__next__ 与 __iter__"></a>__next__ 与 __iter__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__next__ 在next()或者每循环一次执行一次</span><br><span class="line"></span><br><span class="line">__iter__ 在iter()或循环开始之前的时候执行一次</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self,start,stop)</span>:</span></span><br><span class="line">        self.num=start</span><br><span class="line">        self.stop=stop</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__iter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'from __iter__'</span>)</span><br><span class="line">        <span class="keyword">return</span> self</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__next__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'from __next__'</span>)</span><br><span class="line">        <span class="keyword">if</span> self.num &gt;= self.stop:</span><br><span class="line">            <span class="keyword">raise</span> StopIteration</span><br><span class="line">        n=self.num</span><br><span class="line">        self.num+=<span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> n</span><br><span class="line"></span><br><span class="line">f=Foo(<span class="number">1</span>,<span class="number">5</span>)</span><br><span class="line"></span><br><span class="line">f=Foo(<span class="number">1</span>,<span class="number">5</span>)</span><br><span class="line"><span class="keyword">from</span> collections <span class="keyword">import</span> Iterable,Iterator</span><br><span class="line">print(isinstance(f,Iterator))</span><br><span class="line"></span><br><span class="line"><span class="keyword">for</span> i <span class="keyword">in</span> Foo(<span class="number">1</span>,<span class="number">5</span>):</span><br><span class="line">    print(i)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line">True</span><br><span class="line">from __iter__</span><br><span class="line">from __next__</span><br><span class="line">1</span><br><span class="line">from __next__</span><br><span class="line">2</span><br><span class="line">from __next__</span><br><span class="line">3</span><br><span class="line">from __next__</span><br><span class="line">4</span><br><span class="line">from __next__</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="长度计算"><a href="#长度计算" class="headerlink" title="长度计算:"></a>长度计算:</h1><hr>
<h2 id="len"><a href="#len" class="headerlink" title="__len__"></a>__len__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">使用len函数执行</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, value)</span>:</span></span><br><span class="line">        self.value = value</span><br><span class="line">        print(getattr(self, <span class="string">'__dict__'</span>))</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__setattr__</span><span class="params">(self, key, value)</span>:</span></span><br><span class="line">        self.__dict__[key] = value</span><br><span class="line">    </span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__len__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'执行 __len__'</span>)</span><br><span class="line">        count = <span class="number">0</span> </span><br><span class="line">        <span class="keyword">for</span> i <span class="keyword">in</span> self.value:</span><br><span class="line">            count += <span class="number">1</span></span><br><span class="line">        <span class="keyword">return</span> count</span><br><span class="line"></span><br><span class="line">a = Foo([<span class="number">1</span>,<span class="number">2</span>,<span class="number">3</span>,<span class="number">4</span>])</span><br><span class="line">print(len(a))  <span class="comment"># 触发</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">&#123;&#39;value&#39;: [1, 2, 3, 4]&#125;</span><br><span class="line">执行 __len__</span><br><span class="line">4</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="描述信息"><a href="#描述信息" class="headerlink" title="描述信息"></a>描述信息</h1><hr>
<h2 id="doc"><a href="#doc" class="headerlink" title="__doc__"></a>__doc__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">添加一段描述信息,无法被继承,__doc__调用</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="string">"""这是一段描述信息"""</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">print(a.__doc__)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">这是一段描述信息</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="模块与对象"><a href="#模块与对象" class="headerlink" title="模块与对象"></a>模块与对象</h1><hr>
<h2 id="module-与-class"><a href="#module-与-class" class="headerlink" title="__module__ 与 __class__"></a>__module__ 与 __class__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">__module__ 表示当前操作的对象在那个模块</span><br><span class="line"></span><br><span class="line">__class__ 表示当前操作的对象的类是什么</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br></pre></td><td class="code"><pre><span class="line"></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line"></span><br><span class="line">print(a.__module__)</span><br><span class="line">print(a.__class__)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">__main__</span><br><span class="line">&lt;class &#39;__main__.A&#39;&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="资源释放"><a href="#资源释放" class="headerlink" title="资源释放"></a>资源释放</h1><hr>
<h2 id="del"><a href="#del" class="headerlink" title="del"></a><strong>del</strong></h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br></pre></td><td class="code"><pre><span class="line">析构方法,当对象在内存中被释放时,自动触发执行.</span><br><span class="line"></span><br><span class="line">注：如果产生的对象仅仅只是python程序级别的(用户级),那么无需定义__del__,如果产生的对象的同时还会向操作系统发起系统调用,即一个对象有用户级与内核级两种资源,比如(打开一个文件,创建一个数据库链接),则必须在清除对象的同时回收系统资源,这就用到了__del__.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Foo</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__del__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'执行我啦'</span>)</span><br><span class="line"></span><br><span class="line">f1=Foo()</span><br><span class="line"><span class="keyword">del</span> f1</span><br><span class="line">print(<span class="string">'-------&gt;'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">执行我啦</span><br><span class="line">-------&gt;</span><br></pre></td></tr></table></figure>


<hr>
<h1 id="上下文管理协议"><a href="#上下文管理协议" class="headerlink" title="上下文管理协议"></a>上下文管理协议</h1><hr>
<h2 id="enter-与-exit"><a href="#enter-与-exit" class="headerlink" title="__enter__ 与 __exit__"></a>__enter__ 与 __exit__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">上述叫做上下文管理协议,即with语句,为了让一个对象兼容with语句,必须在这个对象的类中声明__enter__和__exit__方法</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Open</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self, name)</span>:</span></span><br><span class="line">        self.name = name</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__enter__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'出现with语句,对象的__enter__被触发,有返回值则赋值给as声明的变量'</span>)</span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__exit__</span><span class="params">(self, exc_type, exc_val, exc_tb)</span>:</span></span><br><span class="line">        print(<span class="string">'with中代码块执行完毕时执行我啊'</span>)</span><br><span class="line">        print(exc_type)</span><br><span class="line">        print(exc_val)</span><br><span class="line">        print(exc_tb)</span><br><span class="line">        <span class="keyword">return</span> <span class="literal">True</span>  <span class="comment"># 如果返回True,异常就会被清空,什么都没发生一样</span></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="keyword">with</span> Open(<span class="string">'a.txt'</span>) <span class="keyword">as</span> f:</span><br><span class="line">    print(<span class="string">'=====&gt;执行代码块'</span>)</span><br><span class="line">    <span class="keyword">raise</span> AttributeError(<span class="string">'***着火啦,救火啊***'</span>)</span><br><span class="line">print(<span class="string">'0'</span> * <span class="number">100</span>)  <span class="comment"># -------------------------------&gt;会执行</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">出现with语句,对象的__enter__被触发,有返回值则赋值给as声明的变量</span><br><span class="line">&#x3D;&#x3D;&#x3D;&#x3D;&#x3D;&gt;执行代码块</span><br><span class="line">with中代码块执行完毕时执行我啊</span><br><span class="line">&lt;class &#39;AttributeError&#39;&gt;</span><br><span class="line">***着火啦,救火啊***</span><br><span class="line">&lt;traceback object at 0x035850D0&gt;</span><br><span class="line">0000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000000</span><br></pre></td></tr></table></figure>

<hr>
<h1 id="调用对象"><a href="#调用对象" class="headerlink" title="调用对象"></a>调用对象</h1><hr>
<h2 id="call"><a href="#call" class="headerlink" title="__call__"></a>__call__</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">__call__,调用实例对象触发</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br></pre></td><td class="code"><pre><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">A</span>:</span></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__init__</span><span class="params">(self)</span>:</span></span><br><span class="line">        <span class="keyword">pass</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">__call__</span><span class="params">(self)</span>:</span></span><br><span class="line">        print(<span class="string">'调用实例对象触发'</span>)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">a = A()</span><br><span class="line">a()  <span class="comment"># 触发</span></span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br></pre></td><td class="code"><pre><span class="line">调用实例对象触发</span><br></pre></td></tr></table></figure>
  </div>

</article>


  <nav id="pagenavi">
    
    <a href="/2020/07/26/2020-07-26-python第五章_元类/" class="prev">上一篇：python第五章_元类</a>
    
    
    <a href="/2020/07/24/2020-07-24-python第五章_反射/" class="next">下一篇：python第五章_反射</a>
    
  </nav>

<a href="#TOC">Top</a>
        </div>
         
        
      </div>
      <footer id="footer" class="inner">
        © 2020 - sgupergitquery -
        <span id="busuanzi_container_site_pv">PV <span id="busuanzi_value_site_pv"></span></span>
        <p>Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a href="https://github.com/thinkerchan/hexo-theme-greyshade" target="_blank" rel="noopener">GreyShade</a></p>
      </footer>
    </div>
  </div>
  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <script async src="https://s5.cnzz.com/z_stat.php?id=1276809529&web_id=1276809529"></script>
</body>
</html>