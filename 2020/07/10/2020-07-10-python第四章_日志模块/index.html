<!DOCTYPE HTML>
<html>
<head>
  <meta charset="utf-8">
  <link rel="dns-prefetch" href="http://yoursite.com">
  
  <title>python第四章_日志模块 | sgupergitquery</title>
  <meta name="author" content="sgupergitquery">
  
  <meta name="description" content="bolg">
  
  
  <meta name="viewport" content="width=device-width,minimum-scale=1,initial-scale=1">

  <meta property="og:title" content="python第四章_日志模块"/>
  <meta property="og:site_name" content="sgupergitquery"/>

  
    <meta property="og:image" content=""/>
  

  <link rel="alternate" href="/atom.xml" title="sgupergitquery" type="application/atom+xml">

  <link rel="preload" as="style" href="/css/style.css" media="screen" type="text/css">
  <link rel="stylesheet" href="/css/style.css" media="screen" type="text/css">

  <link rel="icon" class="js-site-favicon" type="image/svg+xml" href="https://github.githubassets.com/favicons/favicon.svg">
  <link href="https://unpkg.com" rel="dns-prefetch" />
  <link href="https://busuanzi.ibruce.info" rel="dns-prefetch" />
  <link href="https://cdn1.lncld.net" rel="dns-prefetch" />
  
  <link href="https://xpjzs0ff.api.lncld.net" rel="dns-prefetch" />
  
<meta name="generator" content="Hexo 4.2.1"></head>

<body>
  <div class="container">
    <div class="left-col" style="background-image:url('https://tva1.sinaimg.cn/large/007S8ZIlgy1ggdmi6yapmj30dw0zk0wm.jpg')">
      <div class="intrude-less">
        <header id="header" class="inner">
          <a href="/">
            <div class="profilepic"><img src='https://s1.ax1x.com/2020/07/08/UZrhJx.jpg'></div>
          </a>
          <div class="author-name"><a href="/">sgupergitquery</a></div>
          <p class="aboutme">bolg</p>
          <nav id="main-nav">
            <ul class="main">
              
              <li>
                
                  <a href="/archives">归档</a>
                
              </li>
              
              <li>
                
                  <a href="/categories">专题</a>
                
              </li>
              
            </ul>
          </nav>
          <nav id="sub-nav">
            <div class="social">
              
              
              
              
              
              
            </div>
          </nav>
        </header>
      </div>
    </div>
    <div class="mid-col">
      <div class="mid-col-container">
        <div id="content" class="inner">
          <article class="post">

  
    <div class="meta">
      
<div class="date">

<time datetime="2020-07-09T16:00:00.000Z"
      
      data-updated="true"
       itemprop="datePublished">
  2020-07-10
</time>





</div>

    </div>
  
  <h1 class="title" itemprop="name">python第四章_日志模块</h1>
  <div class="entry-content" itemprop="articleBody">
    
    <div class="post-toc">
      <div class="toc-title">TOC</div>
      <ol class="toc"><li class="toc-item toc-level-1"><a class="toc-link" href="#logging"><span class="toc-number">1.</span> <span class="toc-text">logging</span></a><ol class="toc-child"><li class="toc-item toc-level-2"><a class="toc-link" href="#日志等级"><span class="toc-number">1.1.</span> <span class="toc-text">日志等级</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#日志输出到文件"><span class="toc-number">1.2.</span> <span class="toc-text">日志输出到文件</span></a></li><li class="toc-item toc-level-2"><a class="toc-link" href="#模块主要类"><span class="toc-number">1.3.</span> <span class="toc-text">模块主要类</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#logger"><span class="toc-number">1.3.1.</span> <span class="toc-text">logger</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#handler"><span class="toc-number">1.3.2.</span> <span class="toc-text">handler</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#formatter"><span class="toc-number">1.3.3.</span> <span class="toc-text">formatter</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#filter"><span class="toc-number">1.3.4.</span> <span class="toc-text">filter</span></a></li></ol></li><li class="toc-item toc-level-2"><a class="toc-link" href="#日志自动切分"><span class="toc-number">1.4.</span> <span class="toc-text">日志自动切分</span></a><ol class="toc-child"><li class="toc-item toc-level-3"><a class="toc-link" href="#基于文件大小"><span class="toc-number">1.4.1.</span> <span class="toc-text">基于文件大小</span></a></li><li class="toc-item toc-level-3"><a class="toc-link" href="#基于时间间隔"><span class="toc-number">1.4.2.</span> <span class="toc-text">基于时间间隔</span></a></li></ol></li></ol></li></ol>
    </div>
    
    <hr>
<h1 id="logging"><a href="#logging" class="headerlink" title="logging"></a>logging</h1><p>logging 是一个日志模块,支持格式化输出到屏幕和文件,能自定义日志格式,支持日志级别过滤等等功能.</p>
<p>logging 依次从轻到重分为5个级别:  </p>
<ol>
<li>logging.DEBUG  </li>
<li>logging.INFO    </li>
<li>logging.WARNING  </li>
<li>logging.ERROR  </li>
<li>logging.CRIRICAL  </li>
</ol>
<hr>
<h2 id="日志等级"><a href="#日志等级" class="headerlink" title="日志等级"></a>日志等级</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br></pre></td><td class="code"><pre><span class="line">debug(msg, *args, **kwargs)</span><br><span class="line">    Log a message with severity &#39;DEBUG&#39; on the root logger. If the logger has</span><br><span class="line">    no handlers, call basicConfig() to add a console handler with a pre-defined</span><br><span class="line">    format.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">info(msg, *args, **kwargs)</span><br><span class="line">    Log a message with severity &#39;INFO&#39; on the root logger. If the logger has</span><br><span class="line">    no handlers, call basicConfig() to add a console handler with a pre-defined</span><br><span class="line">    format.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">warning(msg, *args, **kwargs)</span><br><span class="line">    Log a message with severity &#39;WARNING&#39; on the root logger. If the logger has</span><br><span class="line">    no handlers, call basicConfig() to add a console handler with a pre-defined</span><br><span class="line">    format.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">error(msg, *args, **kwargs)</span><br><span class="line">    Log a message with severity &#39;ERROR&#39; on the root logger. If the logger has</span><br><span class="line">    no handlers, call basicConfig() to add a console handler with a pre-defined</span><br><span class="line">    format.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">critical(msg, *args, **kwargs)</span><br><span class="line">    Log a message with severity &#39;CRITICAL&#39; on the root logger. If the logger</span><br><span class="line">    has no handlers, call basicConfig() to add a console handler with a</span><br><span class="line">    pre-defined format.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.debug(<span class="string">'DEBUG message'</span>)</span><br><span class="line">logging.info(<span class="string">'INFO message'</span>)</span><br><span class="line">logging.warning(<span class="string">'WARNING message'</span>)</span><br><span class="line">logging.error(<span class="string">'ERROR message'</span>)</span><br><span class="line">logging.critical(<span class="string">'CRITICAL message'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br></pre></td><td class="code"><pre><span class="line"># 因为logging默认日志级别是warning,所以低于warning的日志不会输出.</span><br><span class="line">WARNING:root:WARNING message</span><br><span class="line">ERROR:root:ERROR message</span><br><span class="line">CRITICAL:root:CRITICAL message</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="日志输出到文件"><a href="#日志输出到文件" class="headerlink" title="日志输出到文件"></a>日志输出到文件</h2><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br><span class="line">44</span><br><span class="line">45</span><br><span class="line">46</span><br><span class="line">47</span><br><span class="line">48</span><br><span class="line">49</span><br><span class="line">50</span><br><span class="line">51</span><br><span class="line">52</span><br><span class="line">53</span><br><span class="line">54</span><br><span class="line">55</span><br><span class="line">56</span><br><span class="line">57</span><br><span class="line">58</span><br></pre></td><td class="code"><pre><span class="line">basicConfig(**kwargs)</span><br><span class="line">    Do basic configuration for the logging system.</span><br><span class="line">    对日志系统进行基本配置.</span><br><span class="line">    </span><br><span class="line">    This function does nothing if the root logger already has handlers</span><br><span class="line">    configured. It is a convenience method intended for use by simple scripts</span><br><span class="line">    to do one-shot configuration of the logging package.</span><br><span class="line">    </span><br><span class="line">    The default behaviour is to create a StreamHandler which writes to</span><br><span class="line">    sys.stderr, set a formatter using the BASIC_FORMAT format string, and</span><br><span class="line">    add the handler to the root logger.</span><br><span class="line">    </span><br><span class="line">    A number of optional keyword arguments may be specified, which can alter</span><br><span class="line">    the default behaviour.</span><br><span class="line">    可以指定许多可选的关键字参数,这可以更改默认行为.</span><br><span class="line">    </span><br><span class="line">    filename  Specifies that a FileHandler be created, using the specified</span><br><span class="line">              filename, rather than a StreamHandler.</span><br><span class="line">    filemode  Specifies the mode to open the file, if filename is specified</span><br><span class="line">              (if filemode is unspecified, it defaults to &#39;a&#39;).</span><br><span class="line">    format    Use the specified format string for the handler.</span><br><span class="line">    datefmt   Use the specified date&#x2F;time format.</span><br><span class="line">    style     If a format string is specified, use this to specify the</span><br><span class="line">              type of format string (possible values &#39;%&#39;, &#39;&#123;&#39;, &#39;$&#39;, for</span><br><span class="line">              %-formatting, :meth:&#96;str.format&#96; and :class:&#96;string.Template&#96;</span><br><span class="line">              - defaults to &#39;%&#39;).</span><br><span class="line">    level     Set the root logger level to the specified level.</span><br><span class="line">    stream    Use the specified stream to initialize the StreamHandler. Note</span><br><span class="line">              that this argument is incompatible with &#39;filename&#39; - if both</span><br><span class="line">              are present, &#39;stream&#39; is ignored.</span><br><span class="line">    handlers  If specified, this should be an iterable of already created</span><br><span class="line">              handlers, which will be added to the root handler. Any handler</span><br><span class="line">              in the list which does not have a formatter assigned will be</span><br><span class="line">              assigned the formatter created in this function.</span><br><span class="line"></span><br><span class="line">    常用参数:</span><br><span class="line">    filename 输出文件名.</span><br><span class="line"></span><br><span class="line">    datefmt  使用指定的datetime格式.</span><br><span class="line"></span><br><span class="line">    level    设置输出的日志级别.</span><br><span class="line"></span><br><span class="line">    format 格式输出日志,可选格式:</span><br><span class="line">                %(levelno)s     数字形式的日志级别</span><br><span class="line">                %(levelname)s   文本形式的日志级别</span><br><span class="line">                %(pathname)s    调用日志输出函数的模块的完整路径名</span><br><span class="line">                %(filename)s    调用日志输出函数的模块的文件名</span><br><span class="line">                %(module)s      调用日志输出函数的模块名</span><br><span class="line">                %(funcName)s    调用日志输出函数的函数名</span><br><span class="line">                %(lineno)d      调用日志输出函数语句所在的代码行</span><br><span class="line">                %(created)f     当前时间,用UNIX标准时间的浮点数表示</span><br><span class="line">                %(relativeCreated)d 输出日志信息时的,自Logger创建以来的毫秒数</span><br><span class="line">                %(asctime)s     字符串形式的当前时间,默认格式是&#39;2003-07-08 16:33:34,444&#39;</span><br><span class="line">                %(thread)d      线程id,可能没有</span><br><span class="line">                %(threadName)s  线程名,可能没有</span><br><span class="line">                %(process)d     进程ID,可能没有</span><br><span class="line">                %(message)s     用户输出的消息</span><br><span class="line">                %(name)s        用户名</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line">logging.basicConfig(filename=<span class="string">'test.log'</span>, level=logging.INFO,</span><br><span class="line">                    format=<span class="string">'%(asctime)s %(levelno)s %(filename)s %(process)d %(name)s'</span>,</span><br><span class="line">                    datefmt=<span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 不同日志级别输出</span></span><br><span class="line">logging.debug()</span><br><span class="line">logging.info()</span><br><span class="line">logging.warning()</span><br><span class="line">logging.error()</span><br><span class="line">logging.critical()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># test.log 文件</span><br><span class="line">2020-07-12 21:33:42 20 test.py 6248 root</span><br><span class="line">2020-07-12 21:33:42 30 test.py 6248 root</span><br><span class="line">2020-07-12 21:33:42 40 test.py 6248 root</span><br><span class="line">2020-07-12 21:33:42 50 test.py 6248 root</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="模块主要类"><a href="#模块主要类" class="headerlink" title="模块主要类"></a>模块主要类</h2><p>logger 提供应用程序可以直接使用的接口;<br>handler 将logger创建的日志记录发送到合适的目的地;<br>formatter 决定日志记录的最终输出格式;<br>filter 提供了细读设备来决定输出哪条日志记录;</p>
<hr>
<h3 id="logger"><a href="#logger" class="headerlink" title="logger"></a>logger</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br></pre></td><td class="code"><pre><span class="line">getLogger(name&#x3D;None)</span><br><span class="line">    Return a logger with the specified name, creating it if necessary.</span><br><span class="line">    返回具有指定名称的记录器,并在必要时创建它.</span><br><span class="line"></span><br><span class="line">    If no name is specified, return the root logger.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setLevel(level) method of logging.Logger instance</span><br><span class="line">    Set the logging level of this logger.  level must be an int or a str.</span><br><span class="line">    设置此记录器的日志记录级别,级别必须为int或str.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">addHandler(hdlr) method of logging.Logger instance</span><br><span class="line">    Add the specified handler to this logger.</span><br><span class="line">    将指定的处理程序添加到此记录器.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">addFilter(filter) method of logging.Logger instance</span><br><span class="line">    Add the specified filter to this handler.</span><br><span class="line">    将指定的过滤器添加到此处理程序.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取日志对象,并且调整默认日志级别为logging.DEBUG</span></span><br><span class="line">mysql = logging.getLogger(<span class="string">'mysql'</span>)</span><br><span class="line">print(mysql)</span><br><span class="line">mysql.setLevel(logging.DEBUG)</span><br><span class="line">print(mysql)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Logger mysql (WARNING)&gt;</span><br><span class="line">&lt;Logger mysql (DEBUG)&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="handler"><a href="#handler" class="headerlink" title="handler"></a>handler</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br></pre></td><td class="code"><pre><span class="line">class FileHandler(StreamHandler)</span><br><span class="line"> |  FileHandler(filename, mode&#x3D;&#39;a&#39;, encoding&#x3D;None, delay&#x3D;False)</span><br><span class="line"> |  </span><br><span class="line"> |  A handler class which writes formatted logging records to disk files.</span><br><span class="line"> |  处理程序类,它将格式化的日志记录写入磁盘文件.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">class StreamHandler(Handler)</span><br><span class="line"> |  StreamHandler(stream&#x3D;None)</span><br><span class="line"> |  </span><br><span class="line"> |  A handler class which writes logging records, appropriately formatted,</span><br><span class="line"> |  to a stream. Note that this class does not close the stream, as</span><br><span class="line"> |  sys.stdout or sys.stderr may be used.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setFormatter(fmt) method of logging.FileHandler instance</span><br><span class="line">    Set the formatter for this handler.</span><br><span class="line">    设置此处理程序的格式程序.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">addFilter(filter) method of logging.StreamHandler instance</span><br><span class="line">    Add the specified filter to this handler.</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">setLevel(level) method of logging.Logger instance</span><br><span class="line">    Set the logging level of this logger.  level must be an int or a str.</span><br><span class="line">    设置此记录器的日志记录级别,级别必须为int或str.</span><br><span class="line"></span><br><span class="line">注意:handler也能设置setLevel,如果handler也设置了setLevel,日志先被logger对象setLevel全局过滤然后再在被handler的setLevel过滤,也就是说如果全局设置的日志级别比handler设置的级别高,那handler设置setLevel将没有意义.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取日志对象,并且调整默认日志级别为logging.DEBUG</span></span><br><span class="line">mysql = logging.getLogger(<span class="string">'mysql'</span>)</span><br><span class="line">print(mysql)</span><br><span class="line">mysql.setLevel(logging.DEBUG)</span><br><span class="line">print(mysql)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置日志两种日志输出方式,并且logger对象用addHandler绑定</span></span><br><span class="line">to_file = logging.FileHandler(<span class="string">'mysql.log'</span>)  <span class="comment"># 输出到文件</span></span><br><span class="line">to_console = logging.StreamHandler()  <span class="comment"># 输出到屏幕</span></span><br><span class="line"></span><br><span class="line">mysql.addHandler(to_file)</span><br><span class="line">mysql.addHandler(to_console)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br></pre></td><td class="code"><pre><span class="line">&lt;Logger mysql (WARNING)&gt;</span><br><span class="line">&lt;Logger mysql (DEBUG)&gt;</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="formatter"><a href="#formatter" class="headerlink" title="formatter"></a>formatter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Formatter(builtins.object)</span><br><span class="line"> |  Formatter(fmt&#x3D;None, datefmt&#x3D;None, style&#x3D;&#39;%&#39;)</span><br><span class="line"> |  </span><br><span class="line"> |  Formatter instances are used to convert a LogRecord to text.</span><br><span class="line"> |  格式化程序实例用于将LogRecord转换为文本.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取日志对象,并且调整默认日志级别为logging.DEBUG</span></span><br><span class="line">mysql = logging.getLogger(<span class="string">'mysql'</span>)</span><br><span class="line">print(mysql)</span><br><span class="line">mysql.setLevel(logging.DEBUG)</span><br><span class="line">print(mysql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置日志两种日志输出方式,并且logger对象用addHandler绑定</span></span><br><span class="line">to_file = logging.FileHandler(<span class="string">'mysql.log'</span>)  <span class="comment"># 输出到文件</span></span><br><span class="line">to_console = logging.StreamHandler()  <span class="comment"># 输出到屏幕</span></span><br><span class="line"></span><br><span class="line">mysql.addHandler(to_file)</span><br><span class="line">mysql.addHandler(to_console)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置日志输出格式,并且handler对象用setFormatter绑定</span></span><br><span class="line">to_file_fmt = logging.Formatter(<span class="string">'%(name)s %(asctime)s %(process)d %(levelname)s %(filename)s %(lineno)d'</span>,</span><br><span class="line">                               <span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">to_console_fmt = logging.Formatter(<span class="string">'%(levelname)s %(lineno)d'</span>)</span><br><span class="line"></span><br><span class="line">to_file.setFormatter(to_file_fmt)</span><br><span class="line">to_console.setFormatter(to_console_fmt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不同日志级别输出</span></span><br><span class="line">mysql.debug()</span><br><span class="line">mysql.info()</span><br><span class="line">mysql.warning()</span><br><span class="line">mysql.error()</span><br><span class="line">mysql.critical()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"># 屏幕输出</span><br><span class="line">&lt;Logger mysql (WARNING)&gt;</span><br><span class="line">&lt;Logger mysql (DEBUG)&gt;</span><br><span class="line">DEBUG 34</span><br><span class="line">INFO 35</span><br><span class="line">WARNING 36</span><br><span class="line">ERROR 37</span><br><span class="line">CRITICAL 38</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># mysql.log文件</span><br><span class="line">mysql.log 2020-07-12 22:31:12 14916 DEBUG test.py 34</span><br><span class="line">mysql.log 2020-07-12 22:31:12 14916 INFO test.py 35</span><br><span class="line">mysql.log 2020-07-12 22:31:12 14916 WARNING test.py 36</span><br><span class="line">mysql.log 2020-07-12 22:31:12 14916 ERROR test.py 37</span><br><span class="line">mysql.log 2020-07-12 22:31:12 14916 CRITICAL test.py 38</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 可以看得到to_file_fmt 与 to_console_fmt 格式的不同</span><br></pre></td></tr></table></figure>

<hr>
<h3 id="filter"><a href="#filter" class="headerlink" title="filter"></a>filter</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class Filter(builtins.object)</span><br><span class="line"> |  Filter(name&#x3D;&#39;&#39;)</span><br><span class="line"> |  </span><br><span class="line"> |  Filter instances are used to perform arbitrary filtering of LogRecords.</span><br><span class="line"> |  筛选器实例用于执行LogRecords的任意筛选.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br><span class="line">20</span><br><span class="line">21</span><br><span class="line">22</span><br><span class="line">23</span><br><span class="line">24</span><br><span class="line">25</span><br><span class="line">26</span><br><span class="line">27</span><br><span class="line">28</span><br><span class="line">29</span><br><span class="line">30</span><br><span class="line">31</span><br><span class="line">32</span><br><span class="line">33</span><br><span class="line">34</span><br><span class="line">35</span><br><span class="line">36</span><br><span class="line">37</span><br><span class="line">38</span><br><span class="line">39</span><br><span class="line">40</span><br><span class="line">41</span><br><span class="line">42</span><br><span class="line">43</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"></span><br><span class="line"><span class="comment"># 获取日志对象,并且调整默认日志级别为logging.DEBUG</span></span><br><span class="line">mysql = logging.getLogger(<span class="string">'mysql'</span>)</span><br><span class="line">print(mysql)</span><br><span class="line">mysql.setLevel(logging.DEBUG)</span><br><span class="line">print(mysql)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置日志两种日志输出方式,并且logger对象用addHandler绑定</span></span><br><span class="line">to_file = logging.FileHandler(<span class="string">'mysql.log'</span>)  <span class="comment"># 输出到文件</span></span><br><span class="line">to_console = logging.StreamHandler()  <span class="comment"># 输出到屏幕</span></span><br><span class="line"></span><br><span class="line">mysql.addHandler(to_file)</span><br><span class="line">mysql.addHandler(to_console)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置日志输出格式,并且handler对象用setFormatter绑定</span></span><br><span class="line">to_file_fmt = logging.Formatter(<span class="string">'%(name)s %(asctime)s %(process)d %(levelname)s %(filename)s %(lineno)d'</span>,</span><br><span class="line">                               <span class="string">'%Y-%m-%d %H:%M:%S'</span>)</span><br><span class="line">to_console_fmt = logging.Formatter(<span class="string">'%(levelname)s %(lineno)d'</span>)</span><br><span class="line"></span><br><span class="line">to_file.setFormatter(to_file_fmt)</span><br><span class="line">to_console.setFormatter(to_console_fmt)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 设置过滤, 过滤信息中包含'INFO'的信息, 并且logger对象用addFilter绑定</span></span><br><span class="line"><span class="class"><span class="keyword">class</span> <span class="title">Filter</span><span class="params">(logging.Filter)</span>:</span></span><br><span class="line"></span><br><span class="line">    <span class="function"><span class="keyword">def</span> <span class="title">filter</span><span class="params">(self, record)</span>:</span>  <span class="comment"># 固定写法</span></span><br><span class="line">        <span class="keyword">return</span> <span class="string">'INFO'</span> <span class="keyword">not</span> <span class="keyword">in</span> record.getMessage()</span><br><span class="line"></span><br><span class="line"></span><br><span class="line">mysql.addFilter(Filter())</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 不同日志级别输出</span></span><br><span class="line">mysql.debug()</span><br><span class="line">mysql.info()</span><br><span class="line">mysql.warning()</span><br><span class="line">mysql.error()</span><br><span class="line">mysql.critical()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br></pre></td><td class="code"><pre><span class="line"># 屏幕输出</span><br><span class="line">&lt;Logger mysql (WARNING)&gt;</span><br><span class="line">&lt;Logger mysql (DEBUG)&gt;</span><br><span class="line">DEBUG 44</span><br><span class="line">WARNING 46</span><br><span class="line">ERROR 47</span><br><span class="line">CRITICAL 48</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># mysql.log文件</span><br><span class="line">mysql.log 2020-07-12 22:48:23 15288 DEBUG test.py 44</span><br><span class="line">mysql.log 2020-07-12 22:48:23 15288 WARNING test.py 46</span><br><span class="line">mysql.log 2020-07-12 22:48:23 15288 ERROR test.py 47</span><br><span class="line">mysql.log 2020-07-12 22:48:23 15288 CRITICAL test.py 48</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"># 可以看到mysql.info(&#39;INFO message&#39;)被过滤掉了</span><br></pre></td></tr></table></figure>

<hr>
<h2 id="日志自动切分"><a href="#日志自动切分" class="headerlink" title="日志自动切分"></a>日志自动切分</h2><p>日志输出在一个文件里,长时间日志会越来越大,查看和处理都不方便,需要将日志定时切分处理.</p>
<hr>
<h3 id="基于文件大小"><a href="#基于文件大小" class="headerlink" title="基于文件大小"></a>基于文件大小</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line">class RotatingFileHandler(BaseRotatingHandler)</span><br><span class="line"> |  RotatingFileHandler(filename, mode&#x3D;&#39;a&#39;, maxBytes&#x3D;0, backupCount&#x3D;0, encoding&#x3D;None, delay&#x3D;False)</span><br><span class="line"> |  </span><br><span class="line"> |  Handler for logging to a set of files, which switches from one file</span><br><span class="line"> |  to the next when the current file reaches a certain size.</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br><span class="line">19</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> logging <span class="keyword">import</span> handlers</span><br><span class="line"></span><br><span class="line">mysql = logging.getLogger(<span class="string">'mysql'</span>)</span><br><span class="line">mysql.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"></span><br><span class="line"><span class="comment"># 基于文件大小切分的日志文件</span></span><br><span class="line">to_file = handlers.RotatingFileHandler(filename=<span class="string">'mysql.log'</span>, maxBytes=<span class="number">10</span>, backupCount=<span class="number">3</span>)</span><br><span class="line">mysql.addHandler(to_file)</span><br><span class="line"></span><br><span class="line">to_file_fmt = logging.Formatter(<span class="string">'%(levelname)s %(lineno)d'</span>)</span><br><span class="line">to_file.setFormatter(to_file_fmt)</span><br><span class="line"></span><br><span class="line">mysql.debug()</span><br><span class="line">mysql.info()</span><br><span class="line">mysql.warning()</span><br><span class="line">mysql.error()</span><br><span class="line">mysql.critical()</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br></pre></td><td class="code"><pre><span class="line"># mysql.log</span><br><span class="line">CRITICAL 70</span><br><span class="line"></span><br><span class="line"># mysql.log1</span><br><span class="line">ERROR 69</span><br><span class="line"></span><br><span class="line"># mysql.log2</span><br><span class="line">WARNING 68</span><br><span class="line"></span><br><span class="line"># mysql.log3</span><br><span class="line">INFO 67</span><br></pre></td></tr></table></figure>


<hr>
<h3 id="基于时间间隔"><a href="#基于时间间隔" class="headerlink" title="基于时间间隔"></a>基于时间间隔</h3><figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br></pre></td><td class="code"><pre><span class="line">class TimedRotatingFileHandler(BaseRotatingHandler)</span><br><span class="line"> |  TimedRotatingFileHandler(filename, when&#x3D;&#39;h&#39;, interval&#x3D;1, backupCount&#x3D;0, encoding&#x3D;None, delay&#x3D;False, utc&#x3D;False, atTime&#x3D;None)</span><br><span class="line"> |  </span><br><span class="line"> |  Handler for logging to a file, rotating the log file at certain timed</span><br><span class="line"> |  intervals.</span><br><span class="line"> |  </span><br><span class="line"> |  when: s,m,h,d,w,midnight</span><br></pre></td></tr></table></figure>

<figure class="highlight python"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br><span class="line">6</span><br><span class="line">7</span><br><span class="line">8</span><br><span class="line">9</span><br><span class="line">10</span><br><span class="line">11</span><br><span class="line">12</span><br><span class="line">13</span><br><span class="line">14</span><br><span class="line">15</span><br><span class="line">16</span><br><span class="line">17</span><br><span class="line">18</span><br></pre></td><td class="code"><pre><span class="line"><span class="keyword">import</span> logging</span><br><span class="line"><span class="keyword">from</span> logging <span class="keyword">import</span> handlers</span><br><span class="line"></span><br><span class="line">mysql = logging.getLogger(<span class="string">'mysql'</span>)</span><br><span class="line">mysql.setLevel(logging.DEBUG)</span><br><span class="line"></span><br><span class="line"><span class="comment"># 基于时间切分的日志输出</span></span><br><span class="line">to_file = handlers.TimedRotatingFileHandler(filename=<span class="string">'mysql.log'</span>, when=<span class="string">'s'</span>, interval=<span class="number">5</span>, backupCount=<span class="number">3</span>)</span><br><span class="line">mysql.addHandler(to_file)</span><br><span class="line"></span><br><span class="line">to_file_fmt = logging.Formatter(<span class="string">'%(levelname)s %(lineno)d %(message)s'</span>)</span><br><span class="line">to_file.setFormatter(to_file_fmt)</span><br><span class="line"></span><br><span class="line">mysql.debug(<span class="string">'DEBUG message'</span>)</span><br><span class="line">mysql.info(<span class="string">'INFO message'</span>)</span><br><span class="line">mysql.warning(<span class="string">'WARNING message'</span>)</span><br><span class="line">mysql.error(<span class="string">'ERROR message'</span>)</span><br><span class="line">mysql.critical(<span class="string">'CRITICAL message'</span>)</span><br></pre></td></tr></table></figure>

<figure class="highlight plain"><table><tr><td class="gutter"><pre><span class="line">1</span><br><span class="line">2</span><br><span class="line">3</span><br><span class="line">4</span><br><span class="line">5</span><br></pre></td><td class="code"><pre><span class="line"># 每隔interval&#x3D;5秒执行一次,就会把文件切分</span><br><span class="line"></span><br><span class="line">mysql.log</span><br><span class="line">mysql.log.2020-07-12_23-47-28</span><br><span class="line">mysql.log.2020-07-12_23-47-36</span><br></pre></td></tr></table></figure>
  </div>

</article>


  <nav id="pagenavi">
    
    <a href="/2020/07/11/2020-07-11-python第五章_面向对象/" class="prev">上一篇：python第五章_面向对象</a>
    
    
    <a href="/2020/07/09/2020-07-09-python第四章_正则模块/" class="next">下一篇：python第四章_正则模块</a>
    
  </nav>

        </div>
         
        
      </div>
      <footer id="footer" class="inner">
        © 2020 - sgupergitquery -
        <span id="busuanzi_container_site_pv">PV <span id="busuanzi_value_site_pv"></span></span>
        <p>Powered by <a href="https://hexo.io/" target="_blank" rel="noopener">Hexo</a> & <a href="https://github.com/thinkerchan/hexo-theme-greyshade" target="_blank" rel="noopener">GreyShade</a></p>
      </footer>
    </div>
  </div>
  
  <script async src="https://busuanzi.ibruce.info/busuanzi/2.3/busuanzi.pure.mini.js"></script>
  <script async src="https://s5.cnzz.com/z_stat.php?id=1276809529&web_id=1276809529"></script>
</body>
</html>